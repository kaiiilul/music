# 功能實現總結 (Feature Implementation Summary)

## 概述 (Overview)

本次更新實現了兩個主要功能：

1. **字幕持久化** - 儲存已載入的字幕，下次開啟時自動載入
2. **靜音/取消靜音** - 可以透過點擊音量圖示來切換靜音狀態

## 1. 字幕持久化 (Subtitle Persistence)

### 功能說明
- 當您載入或生成字幕後，字幕檔案路徑會自動儲存到播放清單中
- 下次播放同一首歌曲時，字幕會自動載入，無需重新轉錄或手動載入
- 支援手動載入的 .srt 字幕檔案和 Whisper 自動轉錄的字幕

### 使用方式
1. **自動儲存**：當您載入字幕檔案或 Whisper 轉錄完成時，字幕路徑會自動儲存
2. **自動載入**：下次播放歌曲時，如果有已儲存的字幕，會優先載入字幕而不是重新轉錄
3. **更新字幕**：如果想更換字幕，只需再次點擊「📝 載入字幕檔案」按鈕選擇新的字幕檔案

### 技術細節
- 字幕路徑儲存在 `VideoInfo` 結構的 `subtitlePath` 欄位中
- 資料以 JSON 格式儲存在 `QStandardPaths::AppDataLocation/youtube_playlists.json`
- 在播放音樂時，會先檢查是否有已儲存的字幕檔案
  - 如果有且檔案存在，直接載入字幕
  - 如果沒有或檔案不存在，啟動 Whisper 轉錄

## 2. 靜音/取消靜音功能 (Mute/Unmute Functionality)

### 功能說明
- 現在可以透過點擊音量圖示（🔊/🔉/🔈/🔇）來快速切換靜音狀態
- 靜音時會記住之前的音量，取消靜音時會自動恢復
- 支援在靜音狀態下手動調整音量滑桿來取消靜音

### 使用方式
1. **靜音**：點擊音量圖示，音量會設為 0，圖示變為 🔇
2. **取消靜音**：再次點擊音量圖示，音量恢復到靜音前的數值
3. **手動調整**：在靜音狀態下，您也可以直接拖動音量滑桿來調整音量並自動取消靜音

### 特殊處理
- 如果靜音前音量為 0，取消靜音時會設定為 50（避免保持靜音狀態）
- 只有左鍵點擊音量圖示才會觸發靜音切換（避免意外觸發）
- 音量圖示會根據當前音量自動更新：
  - 🔇：音量 = 0（靜音）
  - 🔈：音量 < 33
  - 🔉：音量 33-65
  - 🔊：音量 >= 66

### 視覺提示
- 音量圖示增加了游標指標效果（cursor: pointer）
- 滑鼠懸停時會顯示提示文字：「點擊以靜音/取消靜音」

## 技術實現細節 (Technical Implementation)

### 資料結構變更
```cpp
struct VideoInfo {
    // ... 其他欄位 ...
    QString subtitlePath;     // 新增：字幕檔案路徑
    // ... 其他欄位 ...
};
```

### 新增成員變數
```cpp
bool isMuted;              // 追蹤是否靜音
int previousVolume;        // 保存靜音前的音量
```

### 新增/修改的方法
- `updateVolumeIcon(int volume)` - 更新音量圖示的輔助方法
- `onVolumeLabelClicked()` - 處理音量圖示點擊事件
- `eventFilter()` - 過濾音量圖示的滑鼠事件
- `playVideo()` - 修改以支援自動載入字幕
- `onLoadSubtitleFileClicked()` - 修改以儲存字幕路徑
- `onWhisperFinished()` - 修改以儲存轉錄的字幕路徑
- `savePlaylistsToFile()` - 修改以儲存字幕路徑到 JSON
- `loadPlaylistsFromFile()` - 修改以從 JSON 載入字幕路徑

## 相容性 (Compatibility)

- **向後相容**：舊的播放清單檔案仍然可以正常載入（subtitlePath 為空）
- **Qt 版本**：支援 Qt 5 和 Qt 6
- **作業系統**：支援 Windows、macOS、Linux

## 測試建議 (Testing Recommendations)

### 字幕持久化測試
1. 載入一首本地音樂檔案
2. 等待 Whisper 轉錄完成或手動載入 .srt 字幕檔案
3. 關閉應用程式
4. 重新開啟應用程式
5. 播放同一首音樂
6. 驗證字幕自動載入（不需要等待轉錄）

### 靜音/取消靜音測試
1. 播放音樂並設定音量為 60
2. 點擊音量圖示靜音（應變為 🔇，音量滑桿移至 0）
3. 再次點擊音量圖示取消靜音（應恢復為 60，圖示恢復）
4. 設定音量為 0，點擊靜音，再點擊取消靜音（應設為 50）
5. 靜音後，嘗試手動調整音量滑桿（應自動取消靜音狀態）

## 已知限制 (Known Limitations)

1. 如果字幕檔案被移動或刪除，將無法自動載入（會退回到 Whisper 轉錄）
2. 字幕路徑是絕對路徑，如果在不同電腦間共享播放清單可能需要重新設定
3. 靜音狀態不會在應用程式重啟後保留（這是有意的設計，避免用戶忘記靜音狀態）

## 未來改進建議 (Future Improvements)

1. 支援相對路徑儲存字幕，提高可攜性
2. 增加字幕快取管理功能
3. 支援鍵盤快速鍵切換靜音（例如 M 鍵）
4. 記憶音量設定到下次啟動
